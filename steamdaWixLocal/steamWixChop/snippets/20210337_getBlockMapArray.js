let NONenrollmentObject = {
    "courses_array": [
        {
            "index": 0,
            "weekId": 1,
            "dateString": "June 7-11, 2021",
            "dateStart": 1623070800000,
            "dateEnd": 1623448800000,
            "value": "1SKC35",
            "billing": {
                "discount": [
                    {
                        "kind": "Early Bird",
                        "amount": 50
                    }
                ],
                "tuition": 345,
                "runningTotal": 295
            },
            "message": {},
            "day": "FULL",
            "courseId": "1SKC35",
            "gradeLevel": "3-5",
            "location": "Charlottesville Catholic",
            "courseName": "Summer Kickoff Camp"
        },
        {
            "index": 0,
            "weekId": 2,
            "dateString": "June 14-18, 2021",
            "dateStart": 1623675600000,
            "dateEnd": 1624053600000,
            "value": "2ML35",
            "billing": {
                "discount": [
                    {
                        "kind": "Early Bird",
                        "amount": 50
                    }
                ],
                "tuition": 345,
                "runningTotal": 590
            },
            "message": {},
            "day": "FULL",
            "courseId": "2ML35",
            "gradeLevel": "3-5",
            "location": "Charlottesville Catholic",
            "courseName": "Matter Lab"
        },
        {
            "index": 0,
            "weekId": 3,
            "dateString": "June 21-25, 2021",
            "dateStart": 1624280400000,
            "dateEnd": 1624658400000,
            "value": "3CP68",
            "billing": {
                "discount": [
                    {
                        "kind": "Early Bird",
                        "amount": 50
                    }
                ],
                "tuition": 345,
                "runningTotal": 885
            },
            "message": {},
            "day": "FULL",
            "courseId": "3CP68",
            "gradeLevel": "6-8",
            "location": "Charlottesville Catholic",
            "courseName": "Computer Programming in Video Games & E-Sports"
        },
        {
            "index": 0,
            "weekId": 4,
            "dateString": "June 28 - July 2, 2021",
            "dateStart": 1624885200000,
            "dateEnd": 1625263200000,
            "value": "4UTS35",
            "billing": {
                "discount": [
                    {
                        "kind": "Early Bird",
                        "amount": 50
                    }
                ],
                "tuition": 345,
                "runningTotal": 1180
            },
            "message": {},
            "day": "FULL",
            "courseId": "4UTS35",
            "gradeLevel": "3-5",
            "location": "Charlottesville Catholic",
            "courseName": "Ultimate Trick Shots"
        },
        {
            "index": 1,
            "weekId": 4,
            "dateString": "June 28 - July 2, 2021",
            "dateStart": 1624885200000,
            "dateEnd": 1625263200000,
            "value": "4PH35",
            "billing": {
                "discount": [
                    null,
                    {
                        "kind": "Early Bird",
                        "amount": 50
                    }
                ],
                "tuition": 345,
                "runningTotal": 1475
            },
            "message": {},
            "day": "FULL",
            "courseId": "4PH35",
            "gradeLevel": "3-5",
            "location": "Charlottesville Catholic",
            "courseName": "Photography"
        },
        {
            "index": 0,
            "weekId": 5,
            "dateString": "July 12-16, 2021",
            "dateStart": 1626094800000,
            "dateEnd": 1626472800000,
            "value": "5MT35",
            "billing": {
                "discount": [
                    {
                        "kind": "Early Bird",
                        "amount": 50
                    }
                ],
                "tuition": 345,
                "runningTotal": 1770
            },
            "message": {},
            "day": "FULL",
            "courseId": "5MT35",
            "gradeLevel": "3-5",
            "location": "STEAM Incubator",
            "courseName": "Media Tech: Sound & Movie Making"
        }
    ],
    "dogs_array": [
        "Marcy",
        "Chester",
        "Marais"
    ],
    "creationDateString": "Wed Mar 24 2021 12:47:23",
    "creationDateUnix": 1616608043000,
    "family": {
        "messages": {
            "dox": [
                "only messages you want the Whole Family to see"
            ]
        },
        "student": {
            "name": {
                "first": "Danny",
                "last": "Partridge",
                "preferred": "Danny",
                "lastFirst": "Partridge, Danny",
                "fullName": "Danny Partridge"
            },
            "messages": {
                "dox": [
                    "messages you want the Student only to see"
                ]
            },
            "dobString": "02/07/2003",
            "currentGrade": 3,
            "currentGradeString": "Third Grade",
            "currentGradeLevel": "3-5"
        },
        "parent": {
            "messages": {
                "dox": [
                    "messages you want Both Parents to see"
                ]
            },
            "primary": {
                "memberId": "INSTANTIATE",
                "messages": {
                    "dox": [
                        "messages you want the Primary Parent/Web Account Holder only to see"
                    ]
                },
                "last": "Partridge",
                "first": "Shirley",
                "fullName": "Shirley Partridge",
                "lastFirst": "Partridge, Shirley"
            }
        },
        "addresses": {
            "mailing": {
                "address": "123 Old Bus Way",
                "address2": "101",
                "city": "Teluca Lake",
                "state": "CA",
                "zip": "90210"
            }
        }
    },
    "family": {
        "messages": {
            "dox": [
                "only messages you want the Whole Family to see"
            ]
        },
        "student": {
            "name": {
                "first": "Danny",
                "last": "Partridge",
                "preferred": "Danny",
                "lastFirst": "Partridge, Danny",
                "fullName": "Danny Partridge"
            },
            "messages": {
                "dox": [
                    "messages you want the Student only to see"
                ]
            },
            "dob": "02/07/2003",
            "currentGrade": "3",
            "currentGradeString": "Third Grade",
            "currentGradeLevel": "3-5"
        }
    },
    "countWeekArray": [
        -999,
        0,
        0,
        1,
        0,
        1,
        0,
        0,
        0,
        0
    ],
    "writeMapWeekArray": [
        -999,
        3,
        5,
        0,
        0,
        0,
        0,
        0,
        0,
        0
    ]
};
let marais = "dog";
let enrollmentObject = {
    "courses_array": [
        {
            "index": 0,
            "weekId": 1,
            "dateString": "June 7-11, 2021",
            "dateStart": 1623070800000,
            "dateEnd": 1623448800000,
            "value": "1SKC35",
            "billing": {
                "discount": [
                    {
                        "kind": "Early Bird",
                        "amount": 50
                    }
                ],
                "tuition": 345,
                "runningTotal": 295
            },
            "message": {},
            "day": "FULL",
            "courseId": "1SKC35",
            "gradeLevel": "3-5",
            "location": "Charlottesville Catholic",
            "courseName": "Summer Kickoff Camp"
        },
        {
            "index": 0,
            "weekId": 2,
            "dateString": "June 14-18, 2021",
            "dateStart": 1623675600000,
            "dateEnd": 1624053600000,
            "value": "2ML35",
            "billing": {
                "discount": [
                    {
                        "kind": "Early Bird",
                        "amount": 50
                    }
                ],
                "tuition": 345,
                "runningTotal": 590
            },
            "message": {},
            "day": "FULL",
            "courseId": "2ML35",
            "gradeLevel": "3-5",
            "location": "Charlottesville Catholic",
            "courseName": "Matter Lab"
        },
        {
            "index": 0,
            "weekId": 3,
            "dateString": "June 21-25, 2021",
            "dateStart": 1624280400000,
            "dateEnd": 1624658400000,
            "value": "3CP68",
            "billing": {
                "discount": [
                    {
                        "kind": "Early Bird",
                        "amount": 50
                    }
                ],
                "tuition": 345,
                "runningTotal": 885
            },
            "message": {},
            "day": "FULL",
            "courseId": "3CP68",
            "gradeLevel": "6-8",
            "location": "Charlottesville Catholic",
            "courseName": "Computer Programming in Video Games & E-Sports"
        },
        {
            "index": 0,
            "weekId": 4,
            "dateString": "June 28 - July 2, 2021",
            "dateStart": 1624885200000,
            "dateEnd": 1625263200000,
            "value": "4UTS35",
            "billing": {
                "discount": [
                    {
                        "kind": "Early Bird",
                        "amount": 50
                    }
                ],
                "tuition": 345,
                "runningTotal": 1180
            },
            "message": {},
            "day": "FULL",
            "courseId": "4UTS35",
            "gradeLevel": "3-5",
            "location": "Charlottesville Catholic",
            "courseName": "Ultimate Trick Shots"
        },
        {
            "index": 1,
            "weekId": 4,
            "dateString": "June 28 - July 2, 2021",
            "dateStart": 1624885200000,
            "dateEnd": 1625263200000,
            "value": "4PH35",
            "billing": {
                "discount": [
                    null,
                    {
                        "kind": "Early Bird",
                        "amount": 50
                    }
                ],
                "tuition": 345,
                "runningTotal": 1475
            },
            "message": {},
            "day": "FULL",
            "courseId": "4PH35",
            "gradeLevel": "3-5",
            "location": "Charlottesville Catholic",
            "courseName": "Photography"
        },
        {
            "index": 0,
            "weekId": 5,
            "dateString": "July 12-16, 2021",
            "dateStart": 1626094800000,
            "dateEnd": 1626472800000,
            "value": "5MT35",
            "billing": {
                "discount": [
                    {
                        "kind": "Early Bird",
                        "amount": 50
                    }
                ],
                "tuition": 345,
                "runningTotal": 1770
            },
            "message": {},
            "day": "FULL",
            "courseId": "5MT35",
            "gradeLevel": "3-5",
            "location": "STEAM Incubator",
            "courseName": "Media Tech: Sound & Movie Making"
        }
    ],
    "dogs_array": [
        "Marcy",
        "Chester",
        "Marais"
    ],
    "creationDateString": "Wed Mar 24 2021 12:47:23",
    "creationDateUnix": 1616608043000,
    "family": {
        "messages": {
            "dox": [
                "only messages you want the Whole Family to see"
            ]
        },
        "student": {
            "name": {
                "first": "Danny",
                "last": "Partridge",
                "preferred": "Danny",
                "lastFirst": "Partridge, Danny",
                "fullName": "Danny Partridge"
            },
            "messages": {
                "dox": [
                    "messages you want the Student only to see"
                ]
            },
            "dobString": "10/1/2012",
            "currentGrade": 3,
            "currentGradeString": "Third Grade",
            "currentGradeLevel": "3-5"
        }
    }, "countWeekArray": [
        -999,
        1,
        1,
        1,
        2,
        1,
        0,
        0,
        0,
        0
    ],
    "writeMapWeekArray": [
        -999,
        1,
        2,
        3,
        4,
        5,
        0,
        0,
        0,
        0
    ]
};
now = new Date;
nowString = now.toString();
nowString = nowString.substr(0, nowString.indexOf("GMT")).trim();
document.getElementById("title").innerHTML = "Coding Output: " + nowString;

// fullBlockMapArray = fillBlockMapArray(enrollmentObject);
fillBlockMapArray(enrollmentObject);
getStudentGradeMisMatchDob(enrollmentObject);

document.getElementById("code").innerHTML = JSON.stringify(enrollmentObject, undefined, 4);

// let dogGreeting = greetingDog('Howdy', 'Chester');
// document.getElementById("code").innerHTML = dogGreeting;

function greetingDog(greeting, dog) {
    return greeting + ' ' + dog + '!';
}

function fillBlockMapArray(enrollmentObject) {
    let testing = true;
    // let testing = false;
    // let countWeekArray = enrollmentObject.countWeekArray;
    // let writeMapWeekArray = enrollmentObject.writeMapWeekArray;
    let blockMapArray = {
        "blockMapErrors": {
            "zeroCheckedCount": -7,
            "multipleCheckedCount": -7
        },
        "blockMapArray": [
            {
                "blockMap": -999,
                "week": -999,
                "switchIdArray": [-999],
                "selectedCount": -999,
                "checkedCount": -999,
                "zeroChecked": -999,
                "multipleChecked": -999,
                "gradeMismatchCount": -999
            },
            {
                "blockMap": 1,
                "week": -7,
                "switchIdArray": ["#switch101", "#switch102", "#switch103"],
                "selectedCount": -7,
                "checkedCount": -7,
                "zeroChecked": -7,
                "multipleChecked": -7,
                "gradeMismatchCount": -7
            },
            {
                "blockMap": 2,
                "week": -7,
                "switchIdArray": ["#switch201", "#switch202", "#switch203"],
                "selectedCount": -7,
                "checkedCount": -7,
                "zeroChecked": -7,
                "multipleChecked": -7,
                "gradeMismatchCount": -7
            },
            {
                "blockMap": 3,
                "week": -7,
                "switchIdArray": ["#switch301", "#switch302", "#switch303"],
                "selectedCount": -7,
                "checkedCount": -7,
                "zeroChecked": -7,
                "multipleChecked": -7,
                "gradeMismatchCount": -7
            },
            {
                "blockMap": 4,
                "week": -7,
                "switchIdArray": ["#switch401", "#switch402", "#switch403"],
                "selectedCount": -7,
                "checkedCount": -7,
                "zeroChecked": -7,
                "multipleChecked": -7,
                "gradeMismatchCount": -7
            },
            {
                "blockMap": 5,
                "week": -7,
                "switchIdArray": ["#switch501", "#switch502", "#switch503"],
                "selectedCount": -7,
                "checkedCount": -7,
                "zeroChecked": -7,
                "multipleChecked": -7,
                "gradeMismatchCount": -7
            },
            {
                "blockMap": 6,
                "week": -7,
                "switchIdArray": ["#switch601", "#switch602", "#switch603"],
                "selectedCount": -7,
                "checkedCount": -7,
                "zeroChecked": -7,
                "multipleChecked": -7,
                "gradeMismatchCount": -7
            },
            {
                "blockMap": 7,
                "week": -7,
                "switchIdArray": ["#switch701", "#switch702", "#switch703"],
                "selectedCount": -7,
                "checkedCount": -7,
                "zeroChecked": -7,
                "multipleChecked": -7,
                "gradeMismatchCount": -7
            },
            {
                "blockMap": 8,
                "week": -7,
                "switchIdArray": ["#switch801", "#switch802", "#switch803"],
                "selectedCount": -7,
                "checkedCount": -7,
                "zeroChecked": -7,
                "multipleChecked": -7,
                "gradeMismatchCount": -7
            },
            {
                "blockMap": 9,
                "week": -7,
                "switchIdArray": ["#switch901", "#switch902", "#switch903"],
                "selectedCount": -7,
                "checkedCount": -7,
                "zeroChecked": -7,
                "multipleChecked": -7,
                "gradeMismatchCount": -7
            }
        ]
    };
    let studentGrade = parseInt(enrollmentObject.family.student.currentGrade);
    let index = 0;
    let element = {};
    let jindex = 0;
    let jisChecked = false;
    let jelement = "";
    let zeroCheckedCount = 0;
    let multipleCheckedCount = 0;
    for (index = 1; index < blockMapArray.blockMapArray.length; index++) {
        element = blockMapArray.blockMapArray[index];
        weekOfBlockIndex = enrollmentObject.writeMapWeekArray[index];
        element.week = weekOfBlockIndex;
        if (weekOfBlockIndex + 0 > 0) {
            // console.log(weekOfBlockIndex);
            // console.log(enrollmentObject.countWeekArray[weekOfBlockIndex]);
            element.selectedCount = enrollmentObject.countWeekArray[weekOfBlockIndex];
        } else {
            element.selectedCount = 0;
        }
        element.checkedCount = 0;
        element.gradeMismatchCount = 0;
        for (let jindex = 0; jindex < element.switchIdArray.length; jindex++) {
            let jelement = element.switchIdArray[jindex];
            if (testing) {
                element.checkedCount = Math.floor(Math.random() * (element.selectedCount + 1));
            } else {
                jisChecked = $w(jelement).checked;
                element.checkedCount += jisChecked ? 1 : 0;
                // FOR: weekOfBlockIndex is WEEK 1 thru 9
                // AND: jindex is Index of Week's Course 0 thru 2
                // AND: jisChecked
                // THEN: getGradeLevel
                let gradeLevel = "3-5";
                let min = gradeLevel.split("-")[0];
                min = min === "K" ? 0 : parseInt(min);
                let max = gradeLevel.split("-")[1];
                max = parseInt(max);
                misMatch = false;
                misMatch = studentGrade < min ? true : misMatch;
                misMatch = studentGrade > max ? true : misMatch;
                console.log(misMatch);
                element.gradeMismatchCount += misMatch ? 1 : 0;

            }
        }
        element.zeroChecked = element.checkedCount === 0 ? 1 : 0;
        element.zeroChecked = element.selectedCount === 0 ? 0 : element.zeroChecked;
        zeroCheckedCount += element.zeroChecked;
        element.multipleChecked = element.checkedCount > 1 ? 1 : 0;
        multipleCheckedCount += element.multipleChecked;


    }
    blockMapArray.blockMapErrors.zeroCheckedCount = zeroCheckedCount;
    blockMapArray.blockMapErrors.multipleCheckedCount = multipleCheckedCount;
    enrollmentObject.blockMapArray = blockMapArray;
    enrollmentObject.enrollment = {};
    enrollmentObject.enrollment.ErrorArray = [];
    enrollmentObject.enrollment.ErrorArray[0] = blockMapArray.blockMapErrors.zeroCheckedCount > 0 ? true : false;
    enrollmentObject.enrollment.ErrorArray[1] = blockMapArray.blockMapErrors.multipleCheckedCount > 0 ? true : false;
    return blockMapArray;

    //  return enrollmentObject + " Chester!";
}

function getCoursesSwitched (enrollmentObject) {
    
}

function getStudentGradeMisMatchDob(enrollmentObject) {
    enrollmentObject.enrollment.messages = {};
    enrollmentObject.enrollment.messages.dox = ["messaging specifically for the Enrollment Event"];
    enrollmentObject.enrollment.messages.error = [];
    enrollmentObject.enrollment.messages.warn = [];
    enrollmentObject.enrollment.messages.fyi = [];
    enrollmentObject.enrollment.messages.btw = [];
    //http://charlottesvilleschools.org/home/programs-activities/kindergarten/
    //In order to enroll, potential kindergarteners must be 5 years old by September 30.
    const monthK = 9;
    const dayK = 30;
    now = new Date;
    const yearK = now.getFullYear()
    let dob = new Date(enrollmentObject.family.student.dobString);
    let dobString = enrollmentObject.family.student.dobString;
    console.log(dobString);
    console.log(dob);
    // enrollmentObject.family.student.dobString = dobString;
    enrollmentObject.family.student.dob = {};
    enrollmentObject.family.student.dob.date = dob;
    let month = dob.getMonth() + 1;
    enrollmentObject.family.student.dob.month = month;
    let day = dob.getDate();
    enrollmentObject.family.student.dob.day = day;
    let year = dob.getFullYear();
    enrollmentObject.family.student.dob.year = year;
    let grade = parseInt(enrollmentObject.family.student.currentGrade);
    let ageK = yearK - year;
    let minusK = 0;
    minusK = month < monthK ? 1 : minusK;
    minusK = month === monthK  && day < dayK ? 1 : minusK;
    ageK -= minusK;
    ageK -= grade; 
    console.log("ageK: " + ageK);
    ageError = Math.abs(ageK - 5) > 1 ? true : false;
    ageWarning = !ageError && Math.abs(ageK - 5) > 0 ? true : false;
    console.log("ageError: " + ageError);
    console.log("ageWarning: " + ageWarning);
    enrollmentObject.enrollment.ErrorArray[3] = ageError;
    if (ageWarning) {
        enrollmentObject.enrollment.messages.warn[enrollmentObject.enrollment.messages.warn.length] = "Student Grade is a Mismatch with Date-of-Birth (1 year)"
    }
    }